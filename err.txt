pipeline {
    agent any // 원본 파이프라인이 실행되는 에이전트 지정 권장
    stages {
        stage('Test SSH Connection') {
            steps {
                script {
                    try {
                        // 동일한 인증 정보 ID 사용
                        withCredentials([
                            sshUserPrivateKey(
                                credentialsId: 'edu-mx-plm-app-node-pk',
                                keyFileVariable: 'SSH_KEY',
                                usernameVariable: 'SSH_USER'
                            )
                        ]) {
                            sshCommand remote: [
                                name: 'test-connection',
                                host: '192.168.56.102',
                                user: SSH_USER,
                                identityFile: SSH_KEY,
                                allowAnyHosts: true
                            ], command: 'echo "Connected successfully!"'
                        }
                    } catch (Exception e) {
                        error("Simple SSH command failed: ${e.getMessage()}")
                        // 전체 스택 트레이스 출력
                        echo "Full error: ${e.toString()}"
                    }
                }
            }
        }
    }
}
